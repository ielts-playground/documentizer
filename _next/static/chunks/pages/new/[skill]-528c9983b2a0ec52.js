(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[875],{7911:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/new/[skill]",function(){return n(4070)}])},4070:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return N}});var s=n(5893),i=n(648),l=n(3870);function r(e){switch(e){case"reading":return"new:reading";case"listening":return"new:listening";case"writing":return"new:writing";default:return}}let o={box:/\*\*\[\[(\d+)?\]\]\*\*/g,title:/\*\*(.+)?\*\*\s*\[\[title\]\]\n*/g,image:/\*\*\[\[image\]\]\*\*\n*/g,selectAnswer:/\*\*(\d+|\d+[\s\D]+\d+)\*\*\s*(.+)?(\n+\*+[A-Z]\*+\s*.+)+\n*/g,questionNumber:/(\d+)/g,questionRange:/(\d+)[\s\D]+(\d+)/g,answerToSelect:/\*+([A-Z])\*+\s*(.+)?\n*/g,writeAnswer:/\*\*(\d+)\*\*\s*(.+)?\n*/g,range:/\*{2,3}questions\s*(\d+)[\s\D]+(\d+)((\s*and\s*\d+[\s\D]+\d+)*)[^A-Za-z]*\*{2,3}\n+/gi,sideRange:/\s*(\d+)[\s\D]+(\d+)(\s*.*)/gi,options:/\*+(true|yes)\*+\s+\**(.+?)\**\n+\*+(false|no)\*+\s+\**(.+?)\**\n+\*+(not given)\*+\s+\**(.+?)\**\n+/gi},a={text:"text",box:"box",title:"title",image:"image",selectAnswer:"question-options",writeAnswer:"question-box",range:"question-range",list:"list",multipleAnswer:"multiple-answer"},u={sort:0,type:"",key:"",value:"",options:{}};async function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:/.*/g,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=[];return e.forEach(e=>{let i=e.value||"";e.type?s.push((async()=>[{...e}])()):s.push((async()=>{let s=[];for(let e of i.matchAll(t))s.push({text:e[0],value:e[1]});let l=[],r=i,o=e.sort;for(let e of s){let t=r.indexOf(e.text);l.push({value:r.substring(0,t),sort:o}),l.push({type:n,value:e.value,sort:o+t});let s=t+e.text.length;r=r.substring(s),o+=s}return l.push({value:r,sort:o}),l})())}),(await Promise.all(s)).flat()}async function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u];return c(e,o.title,a.title)}async function v(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u];return c(e,o.image,a.image)}async function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u];return c(e,o.box,a.box)}async function p(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t={};for(let n of e.matchAll(o.answerToSelect)){let e=n[1],s=n[2];t[e]=s}return t}async function f(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u],t=[];return e.forEach(e=>{let n=e.value||"";e.type?t.push((async()=>[{...e}])()):t.push((async()=>{let t=[];for(let e of n.matchAll(o.selectAnswer))if(e[1]){let n,s;for(let t of e[1].matchAll(o.questionNumber))t[1]&&(n=Number(t[1]));for(let t of e[1].matchAll(o.questionRange))t[1]&&(n=Number(t[1])),t[2]&&(s=Number(t[2]));t.push({text:e[0],size:s?s-n+1:void 0,key:s?"".concat(n,"-").concat(s):n,value:e[2]})}let s=[],i=n,l=e.sort;for(let e of t){let t=i.indexOf(e.text);s.push({value:i.substring(0,t),sort:l}),s.push({type:a.selectAnswer,size:e.size,key:e.key,value:e.value,options:await p(e.text),sort:l+t});let n=t+e.text.length;i=i.substring(n),l+=n}return s.push({value:i,sort:l}),s})())}),(await Promise.all(t)).flat()}async function g(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u],t=[];return e.forEach(e=>{let n=e.value||"";e.type?t.push((async()=>[{...e}])()):t.push((async()=>{let t=[];for(let e of n.matchAll(o.writeAnswer))t.push({text:e[0],key:e[1],value:e[2]});let s=[],i=n,l=e.sort;for(let e of t){let t=i.indexOf(e.text);s.push({value:i.substring(0,t),sort:l}),s.push({type:a.writeAnswer,key:e.key,value:e.value,sort:l+t});let n=t+e.text.length;i=i.substring(n),l+=n}return s.push({value:i,sort:l}),s})())}),(await Promise.all(t)).flat()}async function m(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u],t=[];return e.forEach(e=>{let n=e.value||"";e.type?t.push((async()=>[{...e}])()):t.push((async()=>{let t=[];for(let e of n.matchAll(o.range)){let n={from:Number(e[1]),to:Number(e[2]),and:void 0};if(e[3]){let t;let s=[],i=e[3];for(;i;)for(let e of i.matchAll(o.sideRange))e&&s.push({from:e[1],to:e[2]}),i=e?e[3]:void 0;for(let e=s.length-1;e>=0;e--)t=t?{...s[e],and:t}:s[e];n.and=t}t.push({text:e[0],value:n})}let s=[],i=n,l=e.sort;for(let e of t){let t=i.indexOf(e.text);s.push({value:i.substring(0,t),sort:l}),s.push({type:a.range,value:e.value,sort:l+t});let n=t+e.text.length;i=i.substring(n),l+=n}return s.push({value:i,sort:l}),s})())}),(await Promise.all(t)).flat()}async function y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u];return e.filter(e=>!!e.type&&!(e.type===a.text&&!e.value)||!e.type&&!!e.value).map(e=>e.type===a.image?{...e,key:String(e.sort)}:e)}async function w(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u],t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return e.sort((e,t)=>e.sort<t.sort?-1:1).map(e=>(t&&delete e.sort,e))}function x(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u];return e.flatMap(e=>e.type!==a.text&&e.type?e.type===a.title?{type:"title",value:e.value}:e.type===a.box?{type:"box",kei:e.value}:e.type===a.selectAnswer?{type:"question",size:e.size,kei:e.key,value:e.value,options:e.options}:e.type===a.writeAnswer?{type:"question",kei:e.key,value:e.value}:e.type===a.range?{type:"range",value:e.value}:e.type===a.image?{type:"image",kei:e.key}:void 0:{type:"text",value:e.value})}async function k(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t={value:e.replaceAll(/(\n\n)+/g,"\n\n").replaceAll(/(\n)*(<br>)*(\n)*$/g,"").trim(),sort:0};return Promise.resolve([t]).then(d).then(v).then(f).then(h).then(g).then(m).then(y).then(w).then(x)}var b=n(1163),j=n(7294),_=function(e){null==e||"function"==typeof e||function(e,t){if(!e)throw Error("Invariant failed")}(!1);var t=(0,j.useRef)();(0,j.useEffect)(function(){t.current=function(t){var n=null==e?void 0:e(t);return"string"==typeof n?t.returnValue=n:t.defaultPrevented?t.returnValue="":void 0}},[e]),(0,j.useEffect)(function(){var e=function(e){return t.current(e)};return window.addEventListener("beforeunload",e),function(){window.removeEventListener("beforeunload",e)}},[])},A=n(5890),q=n.n(A);function N(){var e;let t=(0,b.useRouter)(),[n,o]=(0,j.useState)({}),[a,u]=(0,j.useState)("reading"),[c,d]=(0,j.useState)(0),[v,h]=(0,j.useState)(void 0),[p,f]=(0,j.useState)(void 0),[g,m]=(0,j.useState)(!1);(0,j.useEffect)(()=>{let{skill:e}=t.query;u(e)},[t]),(0,j.useEffect)(()=>{let e;let t={};y().forEach(e=>{t[e]={questions:[],answers:{},markdown:{left:"",right:""}}});try{let t=r(a),{content:n,createdAt:s}=JSON.parse(localStorage.getItem(t));Date.now()<s+432e4?e=n:localStorage.removeItem(t)}catch(e){}e?o(e):o(t),d(1)},[a]),_(()=>{let e=r(a);g?localStorage.removeItem(e):localStorage.setItem(e,JSON.stringify({content:n,createdAt:Date.now()}))},[a]);let y=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=[];return"reading"===a?t.push(1,2,3):"listening"===a?t.push(1,2,3,4):"writing"===a&&t.push(1,2),t.filter(t=>t!==e)},w=(e,t)=>{let s={...n};Object.keys(t).forEach(n=>{s[e][n]=t[n]}),o(s)},x=e=>{"image"===e.type&&S(e.kei,e.value)},A=(e,t)=>{let s=n[c].questions.find(t=>t.kei===e);["question","options","box"].includes(s.type)&&n[c]&&w(c,{questions:n[c].questions.map(n=>{if(n.kei===e){if("question"===n.type)return{...n,answer:t};if("options"===n.type)return{...n,selected:t};if("box"===n.type)return{...n,value:t}}return n}),answers:{...n[c].answers,[e]:t}})},N=async()=>{let e={skill:a,components:[],answers:[]};y().forEach(t=>{var s,i;((null===(s=n[t])||void 0===s?void 0:s.questions)||[]).forEach(n=>{e.components.push({...n,part:t})}),Object.keys((null===(i=n[t])||void 0===i?void 0:i.answers)||{}).forEach(s=>{var i;e.answers.push({kei:s,value:((null===(i=n[t])||void 0===i?void 0:i.answers)||{})[s],part:t})})});try{f((0,s.jsx)(s.Fragment,{children:"Submitting..."})),await (0,i.DT)(e,v),m(!0),t.push("/redirect")}catch(e){console.log(e.message)}finally{f(void 0)}},E=()=>{f((0,s.jsx)(l.Vm,{audio:v,onCancel:()=>{f(void 0)},onFinish:e=>{h(e),f(void 0)}}))},S=(e,t)=>{f((0,s.jsx)(l.zv,{initialValue:t,onCancel:()=>{f(void 0)},onFinish:(t,s,i)=>{let l=n[c].questions,r=[];for(let n of l){let l={...n};"image"===n.type&&n.kei===e&&(l.value=t,l.size={width:s,height:i}),r.push(l)}w(c,{questions:r,answers:n[c].answers,markdown:n[c].markdown}),f(void 0)}}))},C=function(){var e,t,i,r,o,a;let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=((null===(e=n[c])||void 0===e?void 0:e.questions)||[]).filter(e=>!e.position),v=((null===(t=n[c])||void 0===t?void 0:t.questions)||[]).filter(e=>!!e.position);u?f((0,s.jsx)(s.Fragment,{children:(0,s.jsx)(l.OP,{markdown:null===(o=n[c])||void 0===o?void 0:null===(a=o.markdown)||void 0===a?void 0:a.right,onCancel:()=>f(void 0),onFinish:async e=>{var t,s;let i=(await k(e)).map(e=>({...e,position:1}));w(c,{questions:[...d,...i],answers:{},markdown:{left:null===(t=n[c])||void 0===t?void 0:null===(s=t.markdown)||void 0===s?void 0:s.left,right:e}}),f(void 0)}})})):f((0,s.jsx)(s.Fragment,{children:(0,s.jsx)(l.OP,{markdown:null===(i=n[c])||void 0===i?void 0:null===(r=i.markdown)||void 0===r?void 0:r.left,onCancel:()=>f(void 0),onFinish:async e=>{var t,s;let i=(await k(e)).map(e=>({...e,position:0}));w(c,{questions:[...i,...v],answers:{},markdown:{left:e,right:null===(t=n[c])||void 0===t?void 0:null===(s=t.markdown)||void 0===s?void 0:s.right}}),f(void 0)}})}))},P=()=>{t.push("/redirect")};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.gx,{}),(0,s.jsxs)("h1",{className:q().header,children:[(0,s.jsx)("span",{children:"".concat(String(a).toUpperCase()," PART ").concat(Number(c))}),y(c).map((e,t)=>(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{children:"|"}),(0,s.jsx)("span",{className:q().part,onClick:()=>d(e),children:e})]},t)),(0,s.jsxs)("span",{className:q().right,children:["reading"===a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:q().edit,onClick:()=>C(),children:"PASSAGE"}),(0,s.jsx)("span",{children:"|"})]}),(0,s.jsx)("span",{className:q().edit,onClick:()=>C(1),children:"reading"===a?"QUESTIONS":"EDIT"}),(0,s.jsx)("span",{children:"|"}),"listening"===a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:v?q().saved:q().edit,onClick:()=>{E()},children:"AUDIO"}),(0,s.jsx)("span",{children:"|"})]}),(0,s.jsx)("span",{className:q().submit,onClick:()=>P(),children:"RETURN"}),(0,s.jsx)("span",{children:"|"}),(0,s.jsx)("span",{className:q().submit,onClick:()=>N(),children:"SUBMIT"})]})]}),(0,s.jsx)(l.Lz,{skill:a,number:c,components:(null===(e=n[c])||void 0===e?void 0:e.questions)||[],onClick:x,onAnswer:A,rightPane:(0,s.jsx)(s.Fragment,{children:(()=>{var e;let t=new Set(((null===(e=n[c])||void 0===e?void 0:e.questions)||[]).filter(e=>["question","box"].includes(e.type)).map(e=>e.kei));return[...t].map(e=>{var t;return{key:e,answered:!!((null===(t=n[c])||void 0===t?void 0:t.answers)||{})[e]}})})().map((e,t)=>{let n={cursor:"pointer",color:e.answered?"red":"black"};return(0,s.jsx)("h1",{style:n,onClick:()=>{let t=document.getElementById(e.key);null==t||t.scrollIntoView({behavior:"smooth"}),null==t||t.focus()},children:e.key},t)})})}),p&&(0,s.jsx)("div",{className:q().container,children:p})]})}},5890:function(e){e.exports={header:"styles_header__p7tCu",part:"styles_part__jt3k6",right:"styles_right__N3sQC",edit:"styles_edit__ZND4V",saved:"styles_saved__PlI1K",submit:"styles_submit__xjXPq",container:"styles_container__RWyuX"}}},function(e){e.O(0,[774,7,860,870,888,179],function(){return e(e.s=7911)}),_N_E=e.O()}]);