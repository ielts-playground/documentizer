(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[971],{566:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/new",function(){return n(7100)}])},7100:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return S}});var s=n(5893),i=n(648),l=n(3870);function r(e){switch(e){case"reading":return"new:reading";case"listening":return"new:listening";case"writing":return"new:writing";default:return}}let o={box:/\*\*\[\[(\d+)?\]\]\*\*/g,title:/\*\*(.+)?\*\*\s*\[\[title\]\]\n*/g,image:/\*\*\[\[image\]\]\*\*\n*/g,selectAnswer:/\*\*(\d+|\d+[\s\D]+\d+)\*\*\s*(.+)?(\n+\*+[A-Z]\*+\s*.+)+\n*/g,questionNumber:/(\d+)/g,questionRange:/(\d+)[\s\D]+(\d+)/g,answerToSelect:/\*+([A-Z])\*+\s*(.+)?\n*/g,writeAnswer:/\*\*(\d+)\*\*\s*(.+)?\n*/g,range:/\*{2,3}questions\s*(\d+)[\s\D]+(\d+)((\s*and\s*\d+[\s\D]+\d+)*)[^A-Za-z]*\*{2,3}\n+/gi,sideRange:/\s*(\d+)[\s\D]+(\d+)(\s*.*)/gi,options:/\*+(true|yes)\*+\s+\**(.+?)\**\n+\*+(false|no)\*+\s+\**(.+?)\**\n+\*+(not given)\*+\s+\**(.+?)\**\n+/gi},a={text:"text",box:"box",title:"title",image:"image",selectAnswer:"question-options",writeAnswer:"question-box",range:"question-range",list:"list",multipleAnswer:"multiple-answer"},u={sort:0,type:"",key:"",value:"",options:{}};async function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:/.*/g,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=[];return e.forEach(e=>{let i=e.value||"";e.type?s.push((async()=>[{...e}])()):s.push((async()=>{let s=[];for(let e of i.matchAll(t))s.push({text:e[0],value:e[1]});let l=[],r=i,o=e.sort;for(let e of s){let t=r.indexOf(e.text);l.push({value:r.substring(0,t),sort:o}),l.push({type:n,value:e.value,sort:o+t});let s=t+e.text.length;r=r.substring(s),o+=s}return l.push({value:r,sort:o}),l})())}),(await Promise.all(s)).flat()}async function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u];return c(e,o.title,a.title)}async function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u];return c(e,o.image,a.image)}async function v(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u];return c(e,o.box,a.box)}async function p(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t={};for(let n of e.matchAll(o.answerToSelect)){let e=n[1],s=n[2];t[e]=s}return t}async function f(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u],t=[];return e.forEach(e=>{let n=e.value||"";e.type?t.push((async()=>[{...e}])()):t.push((async()=>{let t=[];for(let e of n.matchAll(o.selectAnswer))if(e[1]){let n,s;for(let t of e[1].matchAll(o.questionNumber))t[1]&&(n=Number(t[1]));for(let t of e[1].matchAll(o.questionRange))t[1]&&(n=Number(t[1])),t[2]&&(s=Number(t[2]));t.push({text:e[0],size:s?s-n+1:void 0,key:s?"".concat(n,"-").concat(s):n,value:e[2]})}let s=[],i=n,l=e.sort;for(let e of t){let t=i.indexOf(e.text);s.push({value:i.substring(0,t),sort:l}),s.push({type:a.selectAnswer,size:e.size,key:e.key,value:e.value,options:await p(e.text),sort:l+t});let n=t+e.text.length;i=i.substring(n),l+=n}return s.push({value:i,sort:l}),s})())}),(await Promise.all(t)).flat()}async function g(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u],t=[];return e.forEach(e=>{let n=e.value||"";e.type?t.push((async()=>[{...e}])()):t.push((async()=>{let t=[];for(let e of n.matchAll(o.writeAnswer))t.push({text:e[0],key:e[1],value:e[2]});let s=[],i=n,l=e.sort;for(let e of t){let t=i.indexOf(e.text);s.push({value:i.substring(0,t),sort:l}),s.push({type:a.writeAnswer,key:e.key,value:e.value,sort:l+t});let n=t+e.text.length;i=i.substring(n),l+=n}return s.push({value:i,sort:l}),s})())}),(await Promise.all(t)).flat()}async function m(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u],t=[];return e.forEach(e=>{let n=e.value||"";e.type?t.push((async()=>[{...e}])()):t.push((async()=>{let t=[];for(let e of n.matchAll(o.range)){let n={from:Number(e[1]),to:Number(e[2]),and:void 0};if(e[3]){let t;let s=[],i=e[3];for(;i;)for(let e of i.matchAll(o.sideRange))e&&s.push({from:e[1],to:e[2]}),i=e?e[3]:void 0;for(let e=s.length-1;e>=0;e--)t=t?{...s[e],and:t}:s[e];n.and=t}t.push({text:e[0],value:n})}let s=[],i=n,l=e.sort;for(let e of t){let t=i.indexOf(e.text);s.push({value:i.substring(0,t),sort:l}),s.push({type:a.range,value:e.value,sort:l+t});let n=t+e.text.length;i=i.substring(n),l+=n}return s.push({value:i,sort:l}),s})())}),(await Promise.all(t)).flat()}async function y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u];return e.filter(e=>!!e.type&&!(e.type===a.text&&!e.value)||!e.type&&!!e.value).map(e=>e.type===a.image?{...e,key:String(e.sort)}:e)}async function w(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u],t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return e.sort((e,t)=>e.sort<t.sort?-1:1).map(e=>(t&&delete e.sort,e))}function x(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[u];return e.flatMap(e=>e.type!==a.text&&e.type?e.type===a.title?{type:"title",value:e.value}:e.type===a.box?{type:"box",kei:e.value}:e.type===a.selectAnswer?{type:"question",size:e.size,kei:e.key,value:e.value,options:e.options}:e.type===a.writeAnswer?{type:"question",kei:e.key,value:e.value}:e.type===a.range?{type:"range",value:e.value}:e.type===a.image?{type:"image",kei:e.key}:void 0:{type:"text",value:e.value})}async function k(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t={value:e.replaceAll(/(\n\n)+/g,"\n\n").replaceAll(/(\n)*(<br>)*(\n)*$/g,"").trim(),sort:0};return Promise.resolve([t]).then(d).then(h).then(f).then(v).then(g).then(m).then(y).then(w).then(x)}var b=n(1163),j=n(7294),_=function(e){null==e||"function"==typeof e||function(e,t){if(!e)throw Error("Invariant failed")}(!1);var t=(0,j.useRef)();(0,j.useEffect)(function(){t.current=function(t){var n=null==e?void 0:e(t);return"string"==typeof n?t.returnValue=n:t.defaultPrevented?t.returnValue="":void 0}},[e]),(0,j.useEffect)(function(){var e=function(e){return t.current(e)};return window.addEventListener("beforeunload",e),function(){window.removeEventListener("beforeunload",e)}},[])},E=n(2514),A=n.n(E);function S(){var e;let t=(0,b.useRouter)(),[n,o]=(0,j.useState)({}),[a,u]=(0,j.useState)("reading"),[c,d]=(0,j.useState)(0),[h,v]=(0,j.useState)(void 0),[p,f]=(0,j.useState)(void 0),[g,m]=(0,j.useState)(!1),y=e=>{try{let t=r(e),{content:n,createdAt:s}=JSON.parse(localStorage.getItem(t));if(Date.now()<s+432e4)return{content:n};localStorage.removeItem(t)}catch(e){}return{}};(0,j.useEffect)(()=>{let e={};x().forEach(t=>{e[t]={questions:[],answers:{},markdown:{left:"",right:""}}});let{content:t}=y(a);t?o(t):o(e),d(1);let n=localStorage.getItem("new:auto-save");n&&setInterval(w,2e4)},[a]);let w=e=>{let t=r(a);e||g?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify({audio:h,content:n,createdAt:Date.now()}))};_(()=>{w()},[a]);let x=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,n=[];return"reading"===t?n.push(1,2,3):"listening"===t?n.push(1,2,3,4):"writing"===t&&n.push(1,2),n.filter(t=>t!==e)},E=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return["listening","reading","writing"].filter(t=>t!==e)},S=(e,t)=>{let s={...n};Object.keys(t).forEach(n=>{s[e][n]=t[n]}),o(s)},N=e=>{"image"===e.type&&F(e.kei,e.value)},q=(e,t)=>{let s=n[c].questions.find(t=>t.kei===e);["question","options","box"].includes(s.type)&&n[c]&&S(c,{questions:n[c].questions.map(n=>{if(n.kei===e){if("question"===n.type)return{...n,answer:t};if("options"===n.type)return{...n,selected:t};if("box"===n.type)return{...n,value:t}}return n}),answers:{...n[c].answers,[e]:t}})},C=async e=>{let t=confirm("Do you want this test to be FREE?"),n=e=>{let{content:t}=y(e);return O(e,t)},{id:s}=await (0,i.DT)(t?"FREE":"PREMIUM",e,E().map(n));return s},O=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,s={skill:e,components:[],answers:[]};return x(0,e).forEach(e=>{var n,i;((null===(n=t[e])||void 0===n?void 0:n.questions)||[]).forEach(t=>{s.components.push({...t,part:e})}),Object.keys((null===(i=t[e])||void 0===i?void 0:i.answers)||{}).forEach(n=>{var i;s.answers.push({kei:n,value:((null===(i=t[e])||void 0===i?void 0:i.answers)||{})[n],part:e})})}),s},P=()=>{alert("Please select an audio for your Listening test."),I(async e=>{f((0,s.jsx)(s.Fragment,{children:"Submitting..."}));try{let n=await C(e);m(!0),alert("Successfully, test #".concat(n," has been created.")),w(!0),t.push("/home")}catch(t){var n,i;let e=(null===(n=t.response)||void 0===n?void 0:null===(i=n.data)||void 0===i?void 0:i.message)||(null==t?void 0:t.message)||"Something went wrong!";alert('Whoops! It said "'.concat(e,'".'))}f(void 0)})},I=e=>{f((0,s.jsx)(l.Vm,{audio:h,onCancel:()=>{f(void 0)},onFinish:t=>{v(t),f(void 0),e(t)}}))},F=(e,t)=>{f((0,s.jsx)(l.zv,{initialValue:t,onCancel:()=>{f(void 0)},onFinish:(t,s,i)=>{let l=n[c].questions,r=[];for(let n of l){let l={...n};"image"===n.type&&n.kei===e&&(l.value=t,l.size={width:s,height:i}),r.push(l)}S(c,{questions:r,answers:n[c].answers,markdown:n[c].markdown}),f(void 0)}}))},D=function(){var e,t,i,r,o,a;let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=((null===(e=n[c])||void 0===e?void 0:e.questions)||[]).filter(e=>!e.position),h=((null===(t=n[c])||void 0===t?void 0:t.questions)||[]).filter(e=>!!e.position);u?f((0,s.jsx)(s.Fragment,{children:(0,s.jsx)(l.OP,{markdown:null===(o=n[c])||void 0===o?void 0:null===(a=o.markdown)||void 0===a?void 0:a.right,onCancel:()=>f(void 0),onFinish:async e=>{var t,s;let i=(await k(e)).map(e=>({...e,position:1}));S(c,{questions:[...d,...i],answers:{},markdown:{left:null===(t=n[c])||void 0===t?void 0:null===(s=t.markdown)||void 0===s?void 0:s.left,right:e}}),f(void 0)}})})):f((0,s.jsx)(s.Fragment,{children:(0,s.jsx)(l.OP,{markdown:null===(i=n[c])||void 0===i?void 0:null===(r=i.markdown)||void 0===r?void 0:r.left,onCancel:()=>f(void 0),onFinish:async e=>{var t,s;let i=(await k(e)).map(e=>({...e,position:0}));S(c,{questions:[...i,...h],answers:{},markdown:{left:e,right:null===(t=n[c])||void 0===t?void 0:null===(s=t.markdown)||void 0===s?void 0:s.right}}),f(void 0)}})}))},R=()=>{t.push("/home")};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.gx,{}),(0,s.jsxs)("h1",{className:A().header,children:[(0,s.jsx)("span",{className:A().submit,onClick:()=>R(),children:"HOME"}),(0,s.jsx)("span",{children:"|"}),E(a).map((e,t)=>(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{className:A().part,onClick:()=>{w(),u(e)},children:"".concat(String(e).toUpperCase())}),(0,s.jsx)("span",{children:"|"})]},t)),(0,s.jsx)("span",{children:"".concat(String(a).toUpperCase()," PART ").concat(Number(c))}),x(c).map((e,t)=>(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{children:"|"}),(0,s.jsx)("span",{className:A().part,onClick:()=>d(e),children:e})]},t)),(0,s.jsxs)("span",{className:A().right,children:["reading"===a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:A().edit,onClick:()=>D(),children:"PASSAGE"}),(0,s.jsx)("span",{children:"|"})]}),(0,s.jsx)("span",{className:A().edit,onClick:()=>D(1),children:"reading"===a?"QUESTIONS":"EDIT"}),(0,s.jsx)("span",{children:"|"}),"listening"===a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:h?A().saved:A().edit,onClick:()=>{alert("You can choose an audio file when submitting.")},children:"AUDIO"}),(0,s.jsx)("span",{children:"|"})]}),(0,s.jsx)("span",{className:A().submit,onClick:P,children:"SUBMIT"})]})]}),(0,s.jsx)(l.Lz,{skill:a,number:c,components:(null===(e=n[c])||void 0===e?void 0:e.questions)||[],onClick:N,onAnswer:q,rightPane:(0,s.jsx)(s.Fragment,{children:(()=>{var e;let t=new Set(((null===(e=n[c])||void 0===e?void 0:e.questions)||[]).filter(e=>["question","box"].includes(e.type)).map(e=>e.kei));return[...t].map(e=>{var t;return{key:e,answered:!!((null===(t=n[c])||void 0===t?void 0:t.answers)||{})[e]}})})().map((e,t)=>{let n={cursor:"pointer",color:e.answered?"red":"black"};return(0,s.jsx)("h1",{style:n,onClick:()=>{let t=document.getElementById(e.key);null==t||t.scrollIntoView({behavior:"smooth"}),null==t||t.focus()},children:e.key},t)})})}),p&&(0,s.jsx)("div",{className:A().container,children:p})]})}},2514:function(e){e.exports={header:"styles_header__Z_26j",part:"styles_part__K29du",submit:"styles_submit__4c3ZK",right:"styles_right__TNSQX",edit:"styles_edit__XPoiO",saved:"styles_saved__KRi1Y",container:"styles_container__E7dd6"}}},function(e){e.O(0,[774,7,860,870,888,179],function(){return e(e.s=566)}),_N_E=e.O()}]);